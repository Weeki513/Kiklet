<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kiklet</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <main class="app">
      <header class="app-header">
        <div class="app-brand">
          <div class="app-title">Kiklet</div>
          <div class="app-subtitle">Lightweight local voice-to-text</div>
        </div>
        <div class="app-status" id="status">Idle</div>
      </header>

      <section class="panel" aria-label="Settings">
        <div class="panel-head">
          <div class="panel-title">Настройки</div>
          <div class="panel-sub">Персональные параметры и API‑ключ</div>
        </div>

        <div class="settings">
          <!-- 1) Autostart -->
          <div class="row">
            <div class="row-left">
              <div class="label">Автозапуск при старте ПК</div>
              <div class="sub">Запускать Kiklet автоматически</div>
            </div>
            <div class="row-right">
              <label class="toggle">
                <input id="toggle-autostart" type="checkbox" />
                <span class="toggle-track" aria-hidden="true">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
              <div class="inline-msg" id="autostart-msg" hidden></div>
            </div>
          </div>

          <!-- 2) Auto-insert -->
          <div class="row">
            <div class="row-left">
              <div class="label">Автовставка в инпут</div>
              <div class="sub">Вставлять текст в активное поле (позже)</div>
            </div>
            <div class="row-right">
              <label class="toggle">
                <input id="toggle-autoinsert" type="checkbox" />
                <span class="toggle-track" aria-hidden="true">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
              <div class="inline-msg" id="autoinsert-msg" hidden></div>
              <button class="chip-btn" id="btn-test-deliver" type="button" title="Test deliver_text()">Test deliver</button>
              <button class="chip-btn" id="btn-open-permissions" type="button" title="Open OS permissions settings">Open permissions</button>
              <button class="chip-btn" id="btn-check-permissions" type="button" title="Check OS permissions">Check permissions</button>
              <div class="inline-msg" id="deliver-msg" hidden></div>
              <div class="inline-msg" id="perm-msg" hidden></div>
            </div>
          </div>

          <!-- 3) Auto-translate -->
          <div class="row">
            <div class="row-left">
              <div class="label">Автоперевод</div>
              <div class="sub">Язык вывода</div>
            </div>
            <div class="row-right">
              <div style="position: relative; width: 200px;">
                <input
                  id="input-translate"
                  type="text"
                  class="input"
                  placeholder="Не переводить"
                  autocomplete="off"
                  style="width: 100%; padding-right: 30px;"
                />
                <button
                  id="btn-translate-clear"
                  type="button"
                  style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 16px; color: #666; padding: 0; width: 20px; height: 20px; display: none;"
                  title="Очистить"
                >
                  ×
                </button>
                <div
                  id="translate-autocomplete"
                  style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-radius: 4px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; margin-top: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
                ></div>
              </div>
            </div>
          </div>

          <!-- 3.5) Translate Model -->
          <div class="row">
            <div class="row-left">
              <div class="label">Модель перевода</div>
              <div class="sub">Модель, которая выполняет перевод. Рекомендуем: gpt-4.1</div>
            </div>
            <div class="row-right">
              <div class="select">
                <select id="select-translate-model" title="Модель перевода">
                  <option value="gpt-4o">gpt-4o</option>
                </select>
                <span class="select-chev" aria-hidden="true"></span>
              </div>
            </div>
          </div>

          <!-- 4) Hotkey -->
          <div class="row">
            <div class="row-left">
              <div class="label" title="Шорткат для запуска диктофона">Шорткат для запуска диктофона</div>
              <div class="sub">Нажмите, чтобы изменить</div>
            </div>
            <div class="row-right">
              <button class="field" id="field-hotkey" type="button" title="Шорткат для запуска диктофона">
                <span class="field-value" id="hotkey-value">⌘ ⇧ Space</span>
                <span class="icon-btn" aria-hidden="true">✎</span>
              </button>
              <button class="chip-btn" id="hotkey-reset" type="button" hidden title="Сбросить">Сброс</button>
              <div class="inline-msg" id="hotkey-msg" hidden></div>
            </div>
          </div>

          <!-- 4.5) PTT Delay -->
          <div class="row">
            <div class="row-left">
              <div class="label">Задержка Push-to-Talk (мс)</div>
              <div class="sub">Рекомендуется 300 мс. Значение 0 выключает Push-to-Talk.</div>
            </div>
            <div class="row-right">
              <input
                id="input-ptt-threshold"
                type="number"
                min="0"
                step="1"
                class="input"
                style="width: 100px;"
                title="Задержка Push-to-Talk в миллисекундах"
              />
              <div class="inline-msg" id="ptt-threshold-msg" hidden></div>
            </div>
          </div>

          <!-- 5) OpenAI API key -->
          <div class="row">
            <div class="row-left">
              <div class="label">Ваш api‑ключ OpenAI</div>
              <div class="sub">Хранится локально в app data</div>
            </div>
            <div class="row-right">
              <button class="field" id="field-apikey" type="button" title="Ваш api‑ключ OpenAI">
                <span class="field-value mono" id="apikey-masked">sk‑••••••••••••••••••</span>
                <span class="icon-btn" aria-hidden="true">✎</span>
              </button>
            </div>
          </div>

          <!-- 6) Model -->
          <div class="row">
            <div class="row-left">
              <div class="label">Выбрать модель</div>
              <div class="sub">Для транскрипции</div>
            </div>
            <div class="row-right">
              <div class="select">
                <select id="select-model" title="Выбрать модель">
                  <option value="whisper-1">whisper-1</option>
                </select>
                <span class="select-chev" aria-hidden="true"></span>
              </div>
            </div>
          </div>

          <!-- 7) Tutorial -->
          <div class="row row-tutorial">
            <div class="row-left">
              <div class="label">Запустить туториал</div>
              <div class="sub">Короткий walkthrough интерфейса</div>
            </div>
            <div class="row-right">
              <button class="tutorial" id="btn-tutorial" type="button">
                <span>Запустить</span>
                <span class="play" aria-hidden="true">▶</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" aria-label="History">
        <div class="panel-head panel-head-row">
          <div>
            <div class="panel-title">История записей</div>
            <div class="panel-sub" id="history-sub">—</div>
          </div>
          <div class="panel-actions">
            <button class="btn" id="btn-start" type="button" title="Start recording">Start</button>
            <button class="btn" id="btn-stop" type="button" title="Stop recording">Stop</button>
          </div>
        </div>

        <div class="list" id="history-list">
          <div class="list-head">
            <div class="muted" id="count"></div>
            <div class="muted" style="margin-top: 8px; font-size: 12px;">Автоудаление записей старше 30 дней</div>
          </div>
          <div id="items" class="items"></div>
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #eee;">
            <button class="btn btn-secondary" id="btn-clear-history" type="button" style="width: 100%;">Clear history</button>
            <div id="clear-status" class="mono" style="margin-top: 8px; font-size: 12px; line-height: 1.35; color: #333;" hidden></div>
            <div id="js-error" class="mono" style="margin-top: 8px; font-size: 12px; line-height: 1.35; color: #b00020;" hidden></div>
            <button class="btn btn-secondary" id="btn-debug-storage" type="button" style="width: 100%; margin-top: 8px;">Debug storage</button>
            <pre id="debug-storage-out" class="mono" style="margin-top: 8px; white-space: pre-wrap; font-size: 12px; line-height: 1.35; background: #fafafa; border: 1px solid #eee; padding: 8px; border-radius: 10px;" hidden></pre>
          </div>
        </div>
      </section>

      <div class="modal" id="modal" hidden>
        <div class="modal-card">
          <div class="modal-title">OpenAI API key</div>
          <div class="modal-sub">
            Required to transcribe recordings with Whisper. Stored locally in your app data.
          </div>
          <input id="api-key" class="input" type="password" autocomplete="off" spellcheck="false" />
          <div class="modal-actions">
            <button class="btn" id="btn-save-key" type="button">Save</button>
            <button class="btn btn-secondary" id="btn-close-modal" type="button">Close</button>
          </div>
          <div class="modal-status" id="modal-status" hidden></div>
          <div class="modal-error" id="modal-error" hidden></div>
        </div>
      </div>

      <div class="modal" id="details-modal" hidden>
        <div class="modal-card">
          <div class="modal-title">Детали записи</div>
          <div class="modal-sub" id="details-sub">—</div>
          <textarea id="details-text" class="textarea" spellcheck="false" placeholder="Transcription will appear here…" readonly></textarea>
          <div class="modal-actions">
            <button class="btn" id="btn-details-transcribe" type="button">Transcribe</button>
            <button class="btn btn-secondary" id="btn-details-copy" type="button">Copy</button>
            <button class="btn" id="btn-details-reveal" type="button">Reveal</button>
            <button class="btn btn-secondary" id="btn-details-close" type="button">Close</button>
          </div>
        </div>
      </div>

      <div class="modal" id="delete-modal" hidden>
        <div class="modal-card">
          <div class="modal-title">Удалить запись?</div>
          <div class="modal-sub" id="delete-sub">—</div>
          <div class="modal-actions">
            <button class="btn btn-secondary" id="btn-delete-cancel" type="button">Cancel</button>
            <button class="btn" id="btn-delete-confirm" type="button">Delete</button>
          </div>
          <div class="modal-error" id="delete-error" hidden></div>
        </div>
      </div>

      <div class="toast" id="toast" hidden></div>
      <audio id="audio" preload="none"></audio>
    </main>

    <!-- Cursor HUD: shown ONLY during hotkey-driven phases (hidden otherwise) -->
    <div id="cursor-hud" class="cursor-hud cursor-hud-hidden" aria-hidden="true">
      <div class="cursor-hud-row">
        <div id="cursor-hud-text" class="cursor-hud-text">Recording…</div>
        <div id="cursor-hud-meters" class="cursor-hud-meters" aria-hidden="true">
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
          <div class="cursor-hud-meter"></div>
        </div>
      </div>
    </div>
  </body>
</html>
